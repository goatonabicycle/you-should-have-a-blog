---
import { getCollection } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import FormattedDate from "../components/FormattedDate.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";

const posts = (await getCollection("blog"))
	.filter((post) => !post.data.draft)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
const latestPost = posts[0];

let latestPostStats = { words: 0, vowels: 0, consonants: 0 };
if (latestPost) {
	const plainText = latestPost.body || "";
	const words = plainText.split(/\s+/).filter((word) => word.length > 0);
	latestPostStats.words = words.length;

	const letters = plainText.toLowerCase().replace(/[^a-z]/g, "");
	latestPostStats.vowels = (letters.match(/[aeiou]/g) || []).length;
	latestPostStats.consonants = (
		letters.match(/[bcdfghjklmnpqrstvwxyz]/g) || []
	).length;
}
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			.posts-link {
				display: inline-block;
				position: relative;
				outline: none;
				text-decoration: none;
				color: var(--ink);
				padding: 0.2em 0.5em;
				border-radius: 2px;
				transition: all 0.2s ease;
			}

			.posts-link::before {
				content: "> ";
				color: var(--color-accent);
				font-weight: 700;
				opacity: 0;
				transition: opacity 0.2s ease;
			}

			.posts-link:focus {
				background: rgba(125, 211, 252, 0.05);
				color: var(--color-accent);
				text-decoration: underline;
				text-decoration-color: var(--color-accent);
			}

			.posts-link:focus::before {
				opacity: 1;
			}

			.posts-link:hover {
				color: var(--color-accent);
				text-decoration: underline;
				text-decoration-color: var(--color-accent);
			}

			.posts-link:hover::before {
				opacity: 0.6;
			}

			.posts-link::after {
				content: "↵";
				margin-left: 0.5em;
				color: var(--color-dim);
				font-size: 0.8em;
				opacity: 0.7;
				transition: opacity 0.2s ease;
			}

			.posts-link:focus::after {
				color: var(--color-accent);
				opacity: 1;
			}

			.social-links {
				margin-top: 1.5em;
			}

			.latest-post {
				margin-top: 2em;
				padding: 1em;
				background: var(--paper-alt);
				border-radius: 4px;
				border: 1px solid var(--border);
			}

			.latest-post h2 {
				margin-top: 0;
				font-size: 1em;
				color: var(--color-accent);
			}

			.latest-post-link {
				text-decoration: none;
				color: var(--ink);
			}

			.latest-post-link:hover {
				color: var(--color-accent);
				text-decoration: underline;
			}

			.latest-post-date {
				color: var(--color-dim);
				font-size: 0.85em;
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Hello!</h1>
			<p>I am Rowan.</p>
			<p>
				This is a place for some things that I sometimes write about: <a
					href="/blog"
					class="posts-link"
					id="mainLink">Posts</a
				>
			</p>

			{
				latestPost && (
					<div class="latest-post">
						<h2>Latest Post</h2>
						<a
							href={`/blog/${latestPost.id}/`}
							class="latest-post-link"
							id="latestPostLink"
						>
							<strong>{latestPost.data.title}</strong>
						</a>
						<div class="latest-post-date">
							<FormattedDate
								date={latestPost.data.pubDate}
								showDaysAgo={true}
							/>{" "}
							· {latestPostStats.words} words
						</div>
					</div>
				)
			}
		</main>
		<Footer />

		<script>
			const mainLink = document.getElementById("mainLink");
			if (mainLink) {
				mainLink.focus();
			}
		</script>
	</body>
</html>
