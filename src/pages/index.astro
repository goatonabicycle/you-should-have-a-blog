---
import { getCollection } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import FormattedDate from "../components/FormattedDate.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";

const posts = (await getCollection("blog"))
	.filter((post) => !post.data.draft)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
const latestPost = posts[0];

let latestPostStats = { words: 0, vowels: 0, consonants: 0 };
if (latestPost) {
	const plainText = latestPost.body || "";
	const words = plainText.split(/\s+/).filter((word) => word.length > 0);
	latestPostStats.words = words.length;

	const letters = plainText.toLowerCase().replace(/[^a-z]/g, "");
	latestPostStats.vowels = (letters.match(/[aeiou]/g) || []).length;
	latestPostStats.consonants = (
		letters.match(/[bcdfghjklmnpqrstvwxyz]/g) || []
	).length;
}
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			.social-links {
				margin-top: 1.5em;
			}

			.post-card {
				margin-top: 1.5em;
				background: var(--paper-alt);
				border: 1px solid var(--border);
				border-radius: 3px;
				transition: all 0.2s ease;
			}

			.post-card:hover {
				border-color: var(--color-accent);
				background: rgba(125, 211, 252, 0.02);
				transform: translateY(-1px);
				box-shadow: 0 1px 4px rgba(125, 211, 252, 0.08);
			}

			.post-card-content {
				padding: 0.9em 1em;
				text-align: center;
			}

			.post-card-label {
				font-size: 0.75em;
				color: var(--color-dim);
				text-transform: uppercase;
				letter-spacing: 0.05em;
				font-weight: 500;
				margin-bottom: 0.6em;
				transition: color 0.2s ease;
			}

			.post-card:hover .post-card-label {
				color: var(--color-accent);
			}

			.post-card-link {
				text-decoration: none;
				color: var(--ink);
				display: block;
				transition: color 0.2s ease;
			}

			.post-card:hover .post-card-link {
				color: var(--color-accent);
			}

			.post-card-title {
				font-size: 0.95em;
				font-weight: 500;
				margin-bottom: 0.4em;
				transition: color 0.2s ease;
				line-height: 1.3;
			}

			.post-card-meta {
				color: var(--color-dim);
				font-size: 0.8em;
				transition: color 0.2s ease;
			}

			.post-card:hover .post-card-meta {
				color: var(--color-accent);
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Hello!</h1>
			<p>I am Rowan.</p>
			<p>This is a place for some things that I sometimes write about.</p>

			<div class="post-card">
				<div class="post-card-content">
					<a href="/blog" class="post-card-link" id="mainLink">
						<div class="post-card-title">View all posts</div>
						<div class="post-card-meta">→ Browse everything</div>
					</a>
				</div>
			</div>

			{
				latestPost && (
					<div class="post-card latest-post">
						<div class="post-card-content">
							<div class="post-card-label">Latest Post</div>
							<a
								href={`/blog/${latestPost.id}/`}
								class="post-card-link"
								id="latestPostLink"
							>
								<div class="post-card-title">{latestPost.data.title}</div>
								<div class="post-card-meta">
									<FormattedDate date={latestPost.data.pubDate} /> · {latestPostStats.words} words
								</div>
							</a>
						</div>
					</div>
				)
			}
		</main>
		<Footer />

		<script>
			const mainLink = document.getElementById("mainLink");
			if (mainLink) {
				mainLink.focus();
			}
		</script>
	</body>
</html>
