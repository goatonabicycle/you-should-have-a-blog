---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";

type Props = CollectionEntry<"blog">["data"] & {
	wordCount?: number;
	vowelCount?: number;
	consonantCount?: number;
	sentenceCount?: number;
};

const {
	title,
	description,
	pubDate,
	updatedDate,
	wordCount,
	vowelCount,
	consonantCount,
	sentenceCount,
	socialImage,
} = Astro.props;
---

<html lang="en">
	<head>
		<BaseHead
			title={title}
			description={description}
			image={socialImage}
			ogType="article"
			articleDate={pubDate}
		/>
		<style>
			.prose {
				color: var(--ink);
				position: relative;
				max-width: 70ch;
				margin: 0 auto;
				line-height: 1.5;
				font-size: 14px;
			}

			.title {
				margin-bottom: 2em;
				text-align: center;
				padding-bottom: 1.2em;
				border-bottom: 1px solid var(--border);
			}
			.title h1 {
				margin: 0 0 0.8rem 0;
				font-size: 2em;
				color: var(--color-accent);
				font-weight: 600;
				border-bottom: none;
				padding-bottom: 0;
				line-height: 1.2;
				letter-spacing: -0.01em;
			}
			.date {
				color: var(--color-dim);
				font-size: 0.9em;
				text-align: center;
			}
			.last-updated-on {
				font-style: italic;
				margin-top: 0.3em;
				font-size: 0.85em;
			}
			.post-stats {
				color: var(--color-dim);
				font-size: 0.8em;
				margin-top: 0.5em;
				line-height: 1.6;
			}
			.stat-group {
				margin: 0.2em 0;
			}
			/* Typography improvements */
			.prose h2 {
				margin-top: 2em;
				margin-bottom: 0.8em;
				font-size: 1.3em;
				font-weight: 600;
				color: var(--color-accent);
				line-height: 1.3;
			}

			.prose h3 {
				margin-top: 1.8em;
				margin-bottom: 0.6em;
				font-size: 1.15em;
				font-weight: 600;
				color: var(--ink);
				line-height: 1.3;
			}

			.prose p {
				margin-bottom: 1.2em;
				text-align: left;
			}

			.prose ul, .prose ol {
				margin-bottom: 1.2em;
				padding-left: 1.5em;
				line-height: 1.6;
			}

			.prose li {
				margin-bottom: 0.4em;
			}

			.prose blockquote {
				margin: 1.5em 0;
				padding: 0.8em 1.2em;
				background: var(--paper-alt);
				border-left: 3px solid var(--color-accent);
				border-radius: 0 3px 3px 0;
				font-style: italic;
				line-height: 1.6;
			}

			.prose code {
				padding: 0.2em 0.4em;
				background: var(--paper-alt);
				border-radius: 2px;
				font-size: 0.9em;
			}

			.prose pre {
				margin: 1.5em 0;
				padding: 1.2em;
				background: var(--paper-alt);
				border-radius: 4px;
				overflow-x: auto;
				border: 1px solid var(--border);
			}

			.prose pre code {
				padding: 0;
				background: none;
				border-radius: 0;
				font-size: 0.85em;
			}
		</style>
	</head>

	<body>
		<Header />
		<main>
			<article class="prose">
				<div class="title">
					<h1>{title}</h1>
					<div class="date">
						<FormattedDate date={pubDate} />
						{
							updatedDate && (
								<div class="last-updated-on">
									Last updated on <FormattedDate date={updatedDate} />
								</div>
							)
						}
					</div>
					<div class="post-stats">
						<div class="stat-group">
							{wordCount && `${wordCount} words`}
							{sentenceCount && `· ${sentenceCount} sentences`}
						</div>
						<div class="stat-group">
							{vowelCount && `${vowelCount} vowels`}
							{consonantCount && `· ${consonantCount} consonants`}
						</div>
					</div>
				</div>
				<slot />
			</article>
		</main>
		<Footer />

		<script>
			document.addEventListener("keydown", (e) => {
				if (
					e.key === "Backspace" &&
					document.activeElement.tagName !== "INPUT" &&
					document.activeElement.tagName !== "TEXTAREA"
				) {
					e.preventDefault();
					history.back();
				}
			});
		</script>
	</body>
</html>
